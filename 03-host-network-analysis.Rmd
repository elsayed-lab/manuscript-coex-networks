---
author: V. Keith Hughitt
date: "`r format(Sys.time(), '%d %B, %Y')`"
title: "Host Consensus Network Analysis"
params:
  version: "1.0"
  settings: "settings/host-analysis.Rmd"
  analysis_dirname: "host-analysis"
output:
  html_document:
    theme: cosmo
    toc: true
    toc_float: true
    number_sections: true
    code_folding: hide
  pdf_document:
    toc: true
    latex_engine: xelatex
---

Introduction
============

TODO...

Methods
=======

Setup
-----

## Setup

```{r child='child/00-shared-setup.Rmd'}
```

```{r load_libraries}
library('biomaRt')
library('doParallel')
library('dplyr')
library('dynamicTreeCut')
library('flashClust')
library('foreach')
library('goseq')
library('gplots')
library('hpgltools')
library('igraph')
library('knitr')
library('knitcitations')
library('readr')
library('tools')
library('viridis')
source('../../2015/00-shared/R/annotations.R')
source('../../2015/00-shared/R/count_tables.R')
source('../../2015/00-shared/R/enrichment_analysis.R')
source('../../2015/00-shared/R/util.R')
#source('child/03-host-analysis.Rmd')
```

```{r child='../../2015/00-shared/Rmd/init/load_counts.Rmd'}
```

```{r child='../../2015/00-shared/Rmd/init/load_host_annotations.Rmd', eval=CONFIG$target == 'host'}
```

```{r knitr_settings, include=FALSE}
output_prefix <- file.path('output', params$version, "03-host-network-analysis")

output_datadir   <- file.path(output_prefix, 'data')
output_tabledir  <- file.path(output_prefix, 'table')
output_figprefix <- file.path(output_prefix, 'figure/')

# create output directories, if needed
if (!dir.exists(output_datadir)) {
    dir.create(output_datadir, recursive=TRUE)
}

if (!dir.exists(output_tabledir)) {
    dir.create(output_tabledir, recursive=TRUE)
}

cache_dir <- file.path('cache', output_prefix)

opts_chunk$set(fig.width=1920/192,
               fig.height=1920/192,
               fig.path=output_figprefix,
               dpi=192,
               cache.path=cache_dir)

options(digits=3)
options(stringsAsFactors=FALSE)
options(knitr.duplicate.label='allow')
options(java.parameters="-Xmx8g" )

# If rmarkdown.pandoc.to not specified, have it default to 'latex' output
if (is.null(opts_knit$get("rmarkdown.pandoc.to"))) {
    opts_knit$set(rmarkdown.pandoc.to='latex')
}

# Format-specific options
if (opts_knit$get("rmarkdown.pandoc.to") == 'latex') {
    # PDF output
    opts_chunk$set(dev=c('cairo_pdf', 'tiff'), 
  				   dev.args=list(cairo_pdf=list(family="DejaVu Sans"),
                                 tiff=list(compression="lzw")))
} else {
    # HTML output
    #opts_chunk$set(dev=c('png', 'tiff'), fig.retina=1)
    opts_chunk$set(dev=c('png'), fig.retina=1)
}

# plotting parameters
cex_main <- 1.6
cex_lab  <- 1.8
cex_axis <- 1.8
cex_color_labels <- 1.3
```

Infected vs. Uninfected Networks
--------------------------------

### Human infected with *L. major*

```{r load_hslm_networks}
# load infected and uninfected networks
load('output/1.0/02-network-construction/data/adjmat_filtered_hslm-inf.rda')
inf <- filtered_adjmat

load('output/1.0/02-network-construction/data/adjmat_filtered_hslm-uninf.rda')
uninf <- filtered_adjmat

# update figure prefix
opts_chunk$set(fig.path=paste0(output_figprefix, 'hslm-inf-vs-uninf'))
```

```{r child='child/03-host-analysis-inf-vs-uninf.Rmd'}
```

Save Results
------------

```{r save_output, include=FALSE}
# Give rmarkdown some time to finish convern and then copy original rmarkdown
# along with output images and HTML to archive location
html_filepath <- file.path(output_prefix, paste0(MANUSCRIPT_CONFIG$output_dirname, '.html'))

if (opts_knit$get("rmarkdown.pandoc.to") == 'latex') {
    system(sprintf('(sleep 30 && mv 03-host-network-analysis.pdf %s) &', html_filepath))
} else {
    system(sprintf('(sleep 30 && mv 03-host-network-analysis.html %s) &', html_filepath))
}
```

